<% include ../partials/header %>

<div class = "ui grid container">
    
    <div class = "five wide column">
        <div class = "header">
            YelpCamp
        </div>
            <div class = "ui list">
                <div class = "item">
                     <div class = "content">
                    <div class = "ui center aligned block active header">info 1</div>
                  </div>
                </div>
            </div>
            <div id = "map"></div>
            </div>
              <div class = "nine wide column">
               <div class = "ui fluid card">
                   <div class = "image">
                       <img src = "<%= campground.image %>">
                   </div>
                   <div class = "content">
                       <span class = "right floated">$ <%= campground.price%>/night</span>
                       <span class = "left floated">
                          <a href = "/campground/<%= campground._id%>"><%= campground.name %></a> 
                       </span>
                       <div class = "ui hidden divider"></div>
                       <div class = "extra content">
                           <p>
                               <em>Submitted by: <a href = "/user/<%= campground.author.id%>"><%= campground.author.username%></a>, <span><%= moment(campground.createdAt).fromNow() %></span></spa></em>
                               <% if(currentUser && campground.author.id.equals(currentUser._id)|| currentUser && currentUser.isAdmin){ %>
                               <div class = "ui grey basic button">
                                       <a href = "/campground/<%= campground._id%>/edit">Edit Page</a>
                               </div>
                               <form action="/campground/<%= campground.id%>?_method=DELETE" method = "POST">
                                  <button class = "ui grey basic button">Delete</button>
                               </form>
                               <% } %>
                           </p>
                       </div>
                       <div class = "description">
                           <p><%= campground.description %></p>
                       </div>
                       
                   </div>
                    <div class = "ui right aligned grid">
                    <div class = "sixteen wide column">
                   <a class = "ui green button" href = "/campground/<%= campground._id%>/comments/new">Leave a Review</a> 
                </div>
            </div>
        </div>
                  <div class="ui comments">
                    <h3 class = "ui dividing header">Reviews</h3>
                    <% if (campground.comments.length === 0) {%>
                    <em>No comments yet</em>
                    <% } %>
                  <% campground.comments.forEach(function(comment){ %>
                  
                   <div class="comment">
                   <div class="content">
                   <a class="author"><strong><%= comment.author.username %></strong></a>
                   <div class="metadata">
                   <div class="date"><%= moment(comment.createdAt).fromNow()%></div>
                  <div class="rating">
                   <i class="star icon"></i>
                   5 Faves
              </div>
           </div>
            <div class="text">
             <p><%= comment.text %></p>
             <% if(currentUser && comment.author.id.equals(currentUser._id)|| currentUser && currentUser.isAdmin){%>
             <div class = "ui buttons">
                 <button class="mini ui button">
                 <a href = "/campground/<%= campground._id%>/comments/<%= comment._id%>/edit">Edit</a>
              </button>
              <form action ="/campground/<%= campground._id %>/comments/<%=comment._id%>?_method=DELETE" method = "POST">
                  <button class = "mini ui button">Delete</button>
              </form>
             </div>
             <% } %>
             
             <% }) %>
       </div>
     </div>
   </div>
  </div>
 </div>
 <div class = "two wide column">
 </div>
</div>

<script>
  function initMap() {
    var lat = <%= campground.lat %>;
    var lng = <%= campground.lng %>;
    var center = {lat: lat, lng: lng };
    var map = new google.maps.Map(document.getElementById("map"), {
        zoom: 8,
        center: center,
        scrollwheel: false
    });
    var contentString = `
      <strong><%= campground.name %><br />
      <%= campground.location %></strong>
      <p><%= campground.description %></p>
    `
    var infowindow = new google.maps.InfoWindow({
      content: contentString
    });
    var marker = new google.maps.Marker({
        position: center,
        map: map
    });
    marker.addListener('click', function() {
      infowindow.open(map, marker);
    });
  }
</script>
<script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDz0Gf0Q8cgTkxW5yq_mwVovAf8iq2ZoZE&callback=initMap"></script>
